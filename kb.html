<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=0.3,maximum-scale=2,user-scalable=yes" />
		<title>迷你课表</title>

		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/style.css" />
		<script src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/myjs.js"></script>
		<style type="text/css">
			#list {
				margin-top: -1px;
			}
			
			.mui-content {
				min-height: 30px;
			}
			
			body {
				background: #FFF;
			}
		</style>
	</head>

	<body>
		<!--<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<a class="mui-icon mui-icon-redo mui-pull-right" id="shares" style="font-size: 29px;"></a>
			<h1 class="mui-title">全部课表</h1>
		</header>-->
		<div id="kb">
			<table class="bordered" style="table-layout:fixed;" id="tables">
				<thead>
					<tr>
						<th width="20px">#</th>
						<th class="setWidth">星期一</th>
						<th class="setWidth">星期二</th>
						<th class="setWidth">星期三</th>
						<th class="setWidth">星期四</th>
						<th class="setWidth">星期五</th>
						<th class="setWidth">星期六</th>
						<th class="setWidth">星期日</th>
				</thead>

				<tr id="tr1">
				</tr>
				<tr id="tr2">
				</tr>
				<tr id="tr3">
				</tr>
				<tr id="tr4">
				</tr>
				<tr id="tr5">
				</tr>
				<tr id="tr6">
				</tr>
				<tr id="tr7">
				</tr>
			</table>

			<br>
			<br>
		</div>

		<script>
			mui.plusReady(function() {
				mui.init({
					swipeBack: true,
					keyEventBind: {
						backbutton: true
					},
					gestureConfig: {
						longtap: true
					}
				});
				GetAllClass();
			});
			mui('.bordered').on("longtap", 'td', function() {
				var tem = this;
				var text = this.innerHTML;
				var nus = num = this.getAttribute('data-num');
				num = '"' + num + '"';
				//				mui.prompt('迷你课表', text, '修改课表', ['修改', '取消'], function(e) {
				//					var s = e;
				//					if (e.index == 0) {
				//						mui.confirm("是否修改", '修改课表', ['修改', '取消'], function(e) {
				//							if (e.index == 1) {
				//								return 0;
				//							} else {
				//								tem.innerHTML = s.value;
				//								s.value = s.value.replace(/[ ]/g, "")
				//								plus.storage.setItem(num, s.value);
				//								AlertCourse(nus, s.value);
				//								var detailPage = plus.webview.getWebviewById('list.html');
				//								//触发详情页面的newsId事件
				//								mui.fire(detailPage, 'customEvent', {page:'all'});
				//								plus.nativeUI.toast('修改成功');
				//							}
				//						})
				//					}
				//				})
				layerOpen({
					"title": "修改课程表",
					"content": "<textarea id='et' style='background-color: #fff;border: 1px solid #ccc;'>" + text + "</textarea>",
					"btn": ["删除", "取消", "修改"],
					"event": [function() {
						et.value=''
						tem.innerHTML = et.value;
						tem.className=''
							plus.storage.setItem(num, et.value);
							AlertCourse(nus, et.value);
							var detailPage = plus.webview.getWebviewById('list.html');
							//触发详情页面的newsId事件
							mui.fire(detailPage, 'customEvent', {
								page: 'all'
							});
							plus.nativeUI.toast('删除成功');
					}, null,function() {
						var et = document.getElementById("et");
						if (!et.value) {
							alert("请输入内容");
							return true; //继续显示对话框
						} else {
							tem.innerHTML = et.value;
							tem.className='bg-info'
							plus.storage.setItem(num, et.value);
							AlertCourse(nus, et.value);
							var detailPage = plus.webview.getWebviewById('list.html');
							//触发详情页面的newsId事件
							mui.fire(detailPage, 'customEvent', {
								page: 'all'
							});
							plus.nativeUI.toast('修改成功');
						}
					}]
				});
			})
			var index = null; //主页面
			function openMenu() {
				!index && (index = mui.currentWebview.parent());
				mui.fire(index, "menu:open");
			}
		</script>
		<script>
			var shares = {};
			mui.plusReady(function() {
				plus.share.getServices(function(s) {
					if (s && s.length > 0) {
						for (var i = 0; i < s.length; i++) {
							var t = s[i];
							shares[t.id] = t;
						}
					}
				}, function() {
					console.log("获取分享服务列表失败");
				});
				//			defaultImg();
				//			setTimeout(function() {
				//				initImgPreview();
				//			}, 500);
			});

			function shareMessage(share, ex) {
				var msg = {
					extra: {
						scene: ex
					}
				};
				msg.href = "http://a.app.qq.com/o/simple.jsp?pkgname=io.dcloud.H5291D2691";
				msg.title = "迷你课表";
				msg.content = "我在使用迷你课表，里面内置了班级课表，快来看看吧！";
				if (~share.id.indexOf('weibo')) {
					msg.content += "；体验地址：http://cdn.sinacloud.net/minikb/minikb.apk";
				}
				msg.thumbs = ["_www/images/80.png"];
				share.send(msg, function() {
					console.log("分享到\"" + share.description + "\"成功！ ");
				}, function(e) {
					console.log("分享到\"" + share.description + "\"失败: " + e.code + " - " + e.message);
				});
			}
		</script>
	</body>

</html>